include "./Types/WifiScanStatus.fbs";
include "./Types/WifiAuthMode.fbs";
include "./Types/DevicePairStatus.fbs";

attribute "fs_serializer";

namespace OpenShock.Serialization.Local;

table WifiNetwork {
  ssid:string;
  bssid:string;
  channel:uint8;
  rssi:int8;
  auth_mode:Types.WifiAuthMode;
  saved:bool;
}

struct ReadyMessage {
  poggies:bool;
  wifi_connected:bool;
  pair_status:Types.DevicePairStatus;
  rftx_pin:uint8;
}

table ErrorMessage {
  message:string;
}

struct WifiScanStatusMessage {
  status:Types.WifiScanStatus;
}
table WifiNetworkDiscoveredEvent {
  network:WifiNetwork;
}
table WifiNetworkUpdatedEvent {
  network:WifiNetwork;
}
table WifiNetworkLostEvent {
  network:WifiNetwork;
}
table WifiNetworkSavedEvent {
  network:WifiNetwork;
}
table WifiNetworkRemovedEvent {
  network:WifiNetwork;
}
table WifiNetworkConnectedEvent {
  network:WifiNetwork;
}
table WifiNetworkDisconnectedEvent {
  network:WifiNetwork;
}

struct PairStateChangedEvent {
  status:Types.DevicePairStatus;
}

enum SetRfPinResultCode : uint8 {
  Success = 0,
  InvalidPin = 1,
  InternalError = 2
}
table SetRfTxPinCommandResult {
  pin:uint8;
  result:SetRfPinResultCode;
}

union DeviceToLocalMessagePayload {
  ReadyMessage,
  ErrorMessage,
  WifiScanStatusMessage,
  WifiNetworkDiscoveredEvent,
  WifiNetworkUpdatedEvent,
  WifiNetworkLostEvent,
  WifiNetworkSavedEvent,
  WifiNetworkRemovedEvent,
  WifiNetworkConnectedEvent,
  WifiNetworkDisconnectedEvent,
  PairStateChangedEvent,
  SetRfTxPinCommandResult
}

table DeviceToLocalMessage (fs_serializer) {
  payload:DeviceToLocalMessagePayload;
}

root_type DeviceToLocalMessage;
